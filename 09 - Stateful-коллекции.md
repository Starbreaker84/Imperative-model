Коллекция - важная разновидность АТД, которая группирует вместе набор значений в одну составную сущность (контейнер). Одна из двух ключевых характеристик коллекций - это **поддержка индексации** (быстрый доступ к элементам). Другая ключевая характеристика - **хранение фиксированного или переменного количества значений**.

# Индексированные коллекции

В декларативной модели мы познакомились с двумя видами индексированных коллекций: кортежи и записи. Их stateful-версии, соответственно - массивы и словари.

**Массив - это раскладка целых чисел в однозначно соответствующие им конкретные значения**. Область определения (домен) массива - это набор последовательных целых чисел от нижней границы массива до верхней. Область массива задаётся при объявлении массива и не может быть изменена после этого. Чаще всего область определения массива начинается с нуля (C++, C#, Java, Python...), реже с единицы (Julia, Pascal), иногда допускаются и отрицательные значения.
Доступ к элементу массива и его изменение выполняются за константное время O(1).

Если вы не хотите привязываться к конкретной области определения массива, используйте словари.

## Словари

**Словарь - это раскладка простых констант (атомов, имён, целых чисел) в однозначно соответствующие им конкретные значения**. Область определения словаря может свободно меняться в процессе его эксплуатации. Конкретный элемент словаря (item) представляет собой **пару из одной простой константы (ключ) и связанно с ней значения**. Все элементы могут считываться, добавляться, изменяться (изменить ключ в существующем элементе нельзя), удаляться в процессе работы. Доступ к значению по ключу и изменение значения по ключу выполняются за константное время O(1) (чаще всего используются хэш-таблицы), добавление/удаление - за амортизованное константное время (теоретически может периодически выполняться внутренняя реорганизация словаря).

Между словарями и записями есть тесная связь: оба этих типа выполняют раскладку простых констант в значения. Основное различие в том, что записи - stateless, а словари - stateful. В записях допустим фиксированный неизменяемый набор полей/ключей и значений, а в словарях они могут произвольно меняться. 

## Продуктивность индексированных коллекций

В плане продуктивности есть заметные отличия между четырьмя типами индексированных коллекций: кортежи, записи, массивы и словари. Все они обеспечивают доступ к своим элементам по индексу за константное время, однако в остальном заметно отличаются.

**Кортежи** - наиболее ограничены, но работают быстро и требуют мало памяти. Их содержимое не может изменяться, значения хранятся последовательно и хорошо запакованно, поэтому доступ по индексу (который всегда лежит в диапазоне от 1 до N) очень прост.

**Записи** - существенно гибче, нежели кортежи, потому что в качестве индексов могут использоваться любые литералы (атомы или имена) и числа. При этом числа не должны принадлежать какому-то конкретному диапазону. Значения так же хранятся последовательно, и при создании записи создаётся хэш-таблица, которая преобразует имя поля записи в его сдвиг в последовательности значений.

**Массивы** - допускают большую гибкость и изменение своего содержимого. Эффективность остаётся высокой, потому что значения хранятся последовательно, индексный диапазон известен заранее и не изменяем, и позиция конкретного элемента в памяти вычисляется быстро.

**Словари** - наиболее общий случай, комбинирующий возможности массивов и записей. Словари создаются пустыми, никакого явного диапазона индексов (любые литералы и числа) не задаётся, и в целом это наименее эффективная структура данных по времени доступа и обновления. Словари нередко реализуются как динамические хэш-таблицы.

# Неиндексируемые коллекции

Наиболее известны два вида неиндексируемых коллекций: **списки и потоки (стримы, streams)**. Это декларативные типы данных, подразумевающие хранение линейной последовательности. Они могут быть последовательно перебраны от начала до конца, и таких переборов одновременно над одним списком или стримом может выполняться любое количество (однако не всегда они допускают повторный перебор с нуля; например, сетевой поток ввода/вывода, очевидно, такое не позволяет).

Списки имеют конечную фиксированную длину.

Потоки - это незавершённые списки; их хвосты могут содержать несвязанную переменную, что потенциально позволяет их всегда расширять как списки. Поток - одна из наиболее эффективных **расширяемых коллекций**, как по использованию памяти, так и по времени работы.

## Расширяемые коллекции

**Потоки** - эффективно расширяемые коллекции, однако доступ к их произвольному элементу имеет сложность O(N), если такая возможность вообще существует. Другой вид расширяемых коллекций - **словари**, где уже само расширение требует неконстантного времени. Существует также третий вид расширяемых коллекций - **расширяемые (динамические) массивы**, которые мы проходили на первом курсе по алгоритмама/структурам данных. Они по определённой схеме расширяются, когда полностью (или почти полностью) заполнены. В результате амортизационное время расширения оказывается весьма хорошим, значительно лучше словарей, а доступ по индексу обеспечивается за константное время.

## Вопросы для самопроверки:

**24. Отметьте одну неключевую характеристику stateful-коллекций**

( ) хранение фиксированного/переменного количества значений

( ) поддержка индексации

(x) модификация содержимого за константное время

**25. Отметьте один лишний тип данных, не относящийся к индексированным коллекциям**

( ) массивы

( ) кортежи

(x) списки

( ) записи

( ) словари

**26. Какая индексированная коллекция самая быстрая?**

( ) массивы

(x) кортежи

( ) списки

( ) записи

( ) словари

**27. Отметьте один лишний тип данных, не относящийся к расширяемым коллекциям**

( ) массивы

(x) списки

( ) потоки

( ) словари
